{"version":3,"file":"login.min.js","sources":["../src/login.js"],"sourcesContent":["define([], function() {\n    return {\n        initialise : function(strings) {\n            var loginpage = document.getElementById('page-login-index');\n            if (loginpage === null) {\n                // N'exécute pas le script en dehors de la page de login par défaut.\n                return;\n            }\n\n            var shibbolethpage = document.getElementsByClassName('potentialidplist').length;\n            if (shibbolethpage === 0) {\n                // N'exécute pas le script si l'authentification Shibboleth ou CAS n'est pas activée.\n                return;\n            }\n\n            var authid1 = 'internal';\n            var authid2 = 'institutional';\n\n            var content = document.querySelector('#page-login-index #region-main .card-block');\n\n            // Titre de la page.\n            var h3 = document.createElement('h3');\n            var text = document.createTextNode(strings[0]);\n            h3.appendChild(text);\n            h3.setAttribute('class', 'bg-secondary py-2 text-center');\n            content.append(h3);\n\n            // Prépare la liste d'onglets.\n            var tabs = document.createElement('ul');\n            tabs.setAttribute('class', 'nav nav-tabs');\n            tabs.setAttribute('id', 'apsolu-login-tabs-ul');\n            tabs.setAttribute('role', 'tablist');\n            content.append(tabs);\n\n            // Prépare le conteneur des panes.\n            var div = document.createElement('div');\n            div.setAttribute('class', 'tab-content py-3');\n            div.setAttribute('id', 'apsolu-login-panes-div');\n            content.append(div);\n\n            // Transforme les panes.\n            var panes = document.querySelectorAll('#page-login-index .card-body .justify-content-md-center .col-md-5');\n            panes.forEach(function(pane) {\n                if (pane.getElementsByClassName('potentialidplist').length == 0) {\n                    // Pane pour l'authentification locale.\n                    var id = authid1;\n                    var label = strings[1];\n                    var order = 2;\n                } else {\n                    // Pane pour l'authentification universitaire.\n                    var id = authid2;\n                    var label = strings[2];\n                    var order = 1;\n\n                    var localepane = document.getElementById(authid1+'-pane');\n                    if (localepane === null) {\n                        // Supprime quelques libellés inutiles pour l'authentification universitaire.\n                        pane.firstElementChild.remove(); // Paragraphe sur le changement de mot de passe.\n                        pane.firstElementChild.remove(); // Paragraphe sur l'activation des cookies.\n                    } else {\n                        // Déplace quelques libellés dans le pane \"locale\".\n                        localepane.append(pane.firstElementChild); // Paragraphe sur le changement de mot de passe.\n                        localepane.append(pane.firstElementChild); // Paragraphe sur l'activation des cookies.\n                    }\n\n                    pane.firstElementChild.remove(); // Supprime le libellé \"Se connecter au moyen du compte\".\n                }\n\n                // Défini les onglets.\n                var tab = document.createElement('li');\n                tab.setAttribute('class', 'nav-item');\n                tab.style.order = order;\n\n                var a = document.createElement('a');\n                a.setAttribute('aria-controls', id);\n                a.setAttribute('aria-selected', 'false');\n                a.setAttribute('class', 'nav-link');\n                a.setAttribute('data-toggle', 'tab');\n                a.setAttribute('href', '#'+id+\"-pane\");\n                a.setAttribute('role', 'tab');\n\n                var text = document.createTextNode(label);\n\n                a.appendChild(text);\n                tab.append(a);\n                tabs.append(tab);\n\n                pane.setAttribute('aria-labelledby', id);\n                pane.setAttribute('class', 'tab-pane fade col-md-10 offset-md-1');\n                pane.setAttribute('id', id+'-pane');\n                pane.setAttribute('role', 'tabpanel');\n\n                div.append(pane);\n            });\n\n            // Modifie la couleur de liens Shibboleth/CAS.\n            var links = document.querySelectorAll('#page-login-index #institutional-pane a.btn-secondary');\n            links.forEach(function(link) {\n                link.classList.replace('btn-secondary', 'btn-primary');\n\n                var newlink = link.getAttribute('href').replace('/auth/shibboleth/index.php', '/auth/shibboleth/login.php');\n                link.setAttribute('href', newlink);\n            });\n\n            // Défini l'onglet activé par défaut.\n            if (window.location.hash == \"#\"+authid1) {\n                var tab = document.querySelector('a[aria-controls='+authid1+']');\n                tab.setAttribute('class', 'nav-link active show');\n\n                var pane = document.getElementById(authid1+'-pane');\n                pane.classList.add('active', 'show');\n            } else {\n                var tab = document.querySelector('a[aria-controls='+authid2+']');\n                tab.setAttribute('class', 'nav-link active show');\n\n                var pane = document.getElementById(authid2+'-pane');\n                pane.classList.add('active', 'show');\n            }\n        }\n    };\n});\n"],"names":["define","initialise","strings","document","getElementById","getElementsByClassName","length","content","querySelector","h3","createElement","text","createTextNode","appendChild","setAttribute","append","tabs","div","querySelectorAll","forEach","pane","id","label","order","localepane","authid1","firstElementChild","remove","tab","style","a","link","classList","replace","newlink","getAttribute","window","location","hash","add","authid2"],"mappings":"AAAAA,4BAAO,IAAI,iBACA,CACHC,WAAa,SAASC,YAEA,OADFC,SAASC,eAAe,qBAOjB,IADFD,SAASE,uBAAuB,oBAAoBC,YASrEC,QAAUJ,SAASK,cAAc,8CAGjCC,GAAKN,SAASO,cAAc,MAC5BC,KAAOR,SAASS,eAAeV,QAAQ,IAC3CO,GAAGI,YAAYF,MACfF,GAAGK,aAAa,QAAS,iCACzBP,QAAQQ,OAAON,QAGXO,KAAOb,SAASO,cAAc,MAClCM,KAAKF,aAAa,QAAS,gBAC3BE,KAAKF,aAAa,KAAM,wBACxBE,KAAKF,aAAa,OAAQ,WAC1BP,QAAQQ,OAAOC,UAGXC,IAAMd,SAASO,cAAc,UACjCO,IAAIH,aAAa,QAAS,oBAC1BG,IAAIH,aAAa,KAAM,0BACvBP,QAAQQ,OAAOE,KAGHd,SAASe,iBAAiB,qEAChCC,SAAQ,SAASC,SAC2C,GAA1DA,KAAKf,uBAAuB,oBAAoBC,WAE5Ce,GA9BE,WA+BFC,MAAQpB,QAAQ,GAChBqB,MAAQ,MACT,CAECF,GAlCE,gBAmCFC,MAAQpB,QAAQ,GAChBqB,MAAQ,MAERC,WAAarB,SAASC,eAAeqB,iBACtB,OAAfD,YAEAJ,KAAKM,kBAAkBC,SACvBP,KAAKM,kBAAkBC,WAGvBH,WAAWT,OAAOK,KAAKM,mBACvBF,WAAWT,OAAOK,KAAKM,oBAG3BN,KAAKM,kBAAkBC,aAIvBC,IAAMzB,SAASO,cAAc,MACjCkB,IAAId,aAAa,QAAS,YAC1Bc,IAAIC,MAAMN,MAAQA,UAEdO,EAAI3B,SAASO,cAAc,KAC/BoB,EAAEhB,aAAa,gBAAiBO,IAChCS,EAAEhB,aAAa,gBAAiB,SAChCgB,EAAEhB,aAAa,QAAS,YACxBgB,EAAEhB,aAAa,cAAe,OAC9BgB,EAAEhB,aAAa,OAAQ,IAAIO,GAAG,SAC9BS,EAAEhB,aAAa,OAAQ,WAEnBH,KAAOR,SAASS,eAAeU,OAEnCQ,EAAEjB,YAAYF,MACdiB,IAAIb,OAAOe,GACXd,KAAKD,OAAOa,KAEZR,KAAKN,aAAa,kBAAmBO,IACrCD,KAAKN,aAAa,QAAS,uCAC3BM,KAAKN,aAAa,KAAMO,GAAG,SAC3BD,KAAKN,aAAa,OAAQ,YAE1BG,IAAIF,OAAOK,SAIHjB,SAASe,iBAAiB,yDAChCC,SAAQ,SAASY,MACnBA,KAAKC,UAAUC,QAAQ,gBAAiB,mBAEpCC,QAAUH,KAAKI,aAAa,QAAQF,QAAQ,6BAA8B,8BAC9EF,KAAKjB,aAAa,OAAQoB,YAIF,aAAxBE,OAAOC,SAASC,KACNnC,SAASK,cAAc,6BAC7BM,aAAa,QAAS,wBAEfX,SAASC,eAAeqB,iBAC9BO,UAAUO,IAAI,SAAU,aAEnBpC,SAASK,cAAc,kCAC7BM,aAAa,QAAS,wBAEfX,SAASC,eAAeoC,sBAC9BR,UAAUO,IAAI,SAAU"}